"""Helpers for parsing and normalizing target base URLs."""
from __future__ import annotations

from dataclasses import dataclass
from urllib.parse import urlparse


@dataclass(frozen=True)
class TargetInfo:
    base_url: str
    host: str
    port: int
    path: str
    scheme: str


def parse_base_url(base_url: str) -> TargetInfo:
    if not base_url:
        raise ValueError("base_url is required")
    normalized = base_url.strip()
    if "://" not in normalized:
        normalized = f"http://{normalized}"
    parsed = urlparse(normalized)
    scheme = parsed.scheme or "http"
    host = parsed.hostname or "127.0.0.1"
    port = parsed.port or (443 if scheme == "https" else 80)
    path = parsed.path or "/"
    base_url = f"{scheme}://{host}:{port}{path}"
    return TargetInfo(base_url=base_url, host=host, port=port, path=path, scheme=scheme)
