# 실험 설계 요약 (개발자 전달용)

## 1) 평가 대상: 전체 시스템 구성

- **상태(State)**: 지식 저장소 기반
  - 상태로 쓰는 정보 = **"업데이트된 KK 전부 + 에러 유무"**
  - (KK–KV 구조에서, KK 업데이트 집합과 error flag만 관찰)
- **행동(Action)**: 3단 분해 선택 구조
  - **Policy A/B/C = WHAT/HOW/WHERE** 조합으로 행동 결정
- **보상(Reward)**:
  - **외재 보상** + **예측 기반 보상**(다음 상태 예측 오차 ↓ → 보상 ↑)
- **예언(Prophecy) 모듈**:
  - **다음 상태 예측** 수행, **온라인 학습으로 지속 갱신**
- **상상(Imagination) 사이클**:
  - 실행 전 **후보 행동들을 다단계 rollout 비교** 후 행동 선택

---

## 2) 비교 조건(어블레이션)

목적: **예측 기반 보상 vs 실행 전 다중 미래 비교**의 기여 분리

- **C0 (Baseline)**
  - 상상 OFF, 예측 기반 보상 OFF(외재 보상만)
  - 정책 구조는 A/B/C 분해만 사용
- **C1 (Prophecy Only)**
  - 예언 모듈 온라인 학습 ON + 예측 기반 보상 ON
  - 상상 OFF
- **C2 (Imagination + Prophecy)** *(제안 방식)*
  - 예언 ON + 예측 기반 보상 ON + 상상 사이클 ON

---

## 3) 반복/종료 및 리셋 규칙

- 동일 타깃 서버/포트 조건에서 **각 조건 다회 반복 실행**
- 실행은 **에피소드 단위**, 에피소드는 **최대 스텝 수**로 제한
- **FLAG 발견 시**
  - **지식 저장소(KK–KV)만 리셋**, 스텝 카운터 0부터 재시작
  - **정책 테이블 + 예언 모델은 유지** → 성과 누적 학습
- 한 실행 로그 안에 **여러 번의 FLAG 성공 사건**이 포함될 수 있음(각각 별도 성공 사례로 기록)

---

## 4) 실험 절차(런타임 플로우)

1. 로컬에서 **Flask 타깃 서버** 지정 포트로 구동
2. GUI에서 파라미터 설정(최대 에피소드/스텝, 학습률, 상상/예언 ON/OFF)
3. 스텝 루프(DMP)가 매 스텝 수행:
   1. 행동 선택
   2. nmap 실행
   3. XML 파싱
   4. 지식 저장소 업데이트
   5. 보상 계산
   6. 정책/예언 업데이트
4. FLAG 발견 시 성공 이벤트 기록(시간/스텝/히스토리 저장) 후 지식 저장소 리셋
5. 최대 에피소드 도달 또는 수동 중단까지 반복

---

## 5) 측정 지표(로그 기반)

**성공 지표**

- FLAG 최초 발견까지 **스텝 수**
- FLAG 최초 발견까지 **경과 시간**
- 실행 중 **FLAG 발견 횟수**(리셋 기준 성공 사건 수)

**탐색/학습 지표**

- 에피소드당 **고유 (A,B,C) 조합 수**(행동 다양성)
- 동일 조합 **반복 횟수 분포(n 분포)**
- **지식 업데이트 발생 비율**(ΔKK ≠ ∅인 스텝 비율)
- 업데이트된 **KK 종류 커버리지**(어떤 KK가 얼마나 자주 갱신되는지)

**예언 모듈 지표**

- 예측 손실의 시간 변화(온라인 학습 수렴 양상)
- 예측 기반 보상 분포 및 외재 보상 대비 상대 크기

**안정성 지표**

- syntax error 발생률
- non-syntax error 발생률
- 에러 후 회복 여부(정상 스텝 복귀 패턴)

---

## 6) 분석 포인트(비교 질문)

- **C1**(예측 기반 보상)이 성공까지의 **스텝/시간을 줄이는가**
- **C2**(상상 사이클)가
  - 불필요한 반복(동일 조합 반복, n 증가)을 **줄이는가**
  - 지식 업데이트 빈도를 **늘리는가**
- 예언 손실이 감소하는 구간에서 **정책 분포 변화(집중 vs 탐색 유지)**가 어떻게 나타나며, 탐색 패턴이 어떻게 바뀌는가
