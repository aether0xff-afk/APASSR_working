# 📎 리뷰 노트 (Architect / Research POV)

## 총평

- ✅ 방향 정확함
- ✅ 패턴 보존 원칙 잘 지켜짐
- ✅ “관측 기반 / 의미 해석 금지” 철학이 코드 레벨로 반영됨
- ✅ 스프린트 분리도 현실적

👉 이 계획은 그대로 진행해도 됨  
다만, 나중에 되돌리기 어려운 지점 4곳이 있어서 사전 합의만 추가하면 훨씬 안전해짐.

---

## Sprint 1 리뷰 — JSON 스키마 & KK 확장

### 👍 잘 된 점

- 공통 JSON 스키마를 Parser 레벨에서만 해석  
  → ToolAdapter 자유도 유지
- KK를 “현상 토큰”으로만 확장  
  → 취약점 이름 미도입 원칙 유지
- WebJSONParser에 매핑 레이어 추가라는 접근이 깔끔함

### ⚠️ 보완 제안 (중요)

1) **KK 네이밍 규칙을 문서로 고정할 것**  
   나중에 가장 흔히 무너지는 지점임.

   제안 (knowledge.py 상단에 명시):
   - 동사/의도/취약점명 금지
   - 반드시 관측 결과 또는 관계 변화만 허용
   - 예:  
     - ❌ POSSIBLE_*, LIKELY_*  
     - ⭕ *_DETECTED, *_VARIANCE_HIGH, *_SHIFT

2) **스키마 버전 필드 추가 권장**  
   `"schema_version": "webtool-v1"`

   Parser가 버전에 따라 graceful degrade 가능  
   Sprint 2/3에서 확장 시 안전

---

## Sprint 2 리뷰 — 보상 & 상태 전이

### 👍 잘 된 점

- FLAG 제거 가능 설계 👍
- 정보이득 + 비용 패널티 구조 명확
- 상태 전이를 Parser 단계에서 KK로 승격하는 위치 선정이 정확함

### ⚠️ 핵심 리스크 & 대응

3) **“상태 전이” 정의를 느슨하게 둘 것**  
   AUTH_BOUNDARY_SHIFT 같은 KK는 너무 강하게 정의하면 깨짐.

   권장 기준
   - “인증 성공” ❌
   - “쿠키 세트 변경 + 접근 가능한 URL 집합 증가” ⭕
   - “명확한 원인 추정” ❌
   - “관측된 결과의 변화” ⭕

   👉 reward.py에서는 원인 추론 금지,  
   오직 전/후 상태 차이량만 사용해야 함.

4) **Cost penalty 상한선 합의 필요**

   요청 수/시간 패널티가 너무 세면 탐색이 멈춤  
   너무 약하면 난사로 흐름

   제안  
   - Sprint 2에서는 선형 패널티만  
   - 비선형(지수/쿼드)은 Sprint 4 이후로 미룸

---

## Sprint 3 리뷰 — 시나리오 & 리포팅

### 👍 잘 된 점

- HTB 스타일 시나리오를 로컬 재현으로 고정 → 최고 선택
- 리포트 포맷을 훈련 결과 저장 용도로 먼저 정의 → 상용 확장에 유리

### ⚠️ 추가 제안

5) **리포트는 “결론 요약”보다 “증거 로그 중심”**

상용/연구 둘 다 살리려면:
- ❌ “이 서버는 위험함”
- ⭕ “이런 관측이 있었고, 이런 상태 전이가 있었음”

리포트 섹션 예:
- Observed Surfaces
- State Transitions
- High-Leverage Inputs (관측 기반)
- Cost Summary
- Policy Trace (선택 로그)

---

## 패턴 유지 관련 최종 확인 ✅

아래 모두 OK:
- ToolAdapter / ParsedResult / DMP 유지
- 스키마 통일은 입력 규약일 뿐, 구조 변경 아님
- 매핑/보상은 얇은 레이어 추가
- 취약점 분류/이름 미도입 원칙 유지

👉 아키텍처 무결성 깨지는 지점 없음

---

## 최종 결론 (개발자에게 전달용 한 문장)

이 계획은 승인 가능하며,  
관측 기반 철학을 유지한 채 다중 툴 RL로 확장하기 위한 가장 안전한 최소 변경안이다.  
단, KK 네이밍 규칙·스키마 버전·상태 전이 정의 범위만 사전에 고정하면 이후 리팩토링 리스크가 크게 줄어든다.
